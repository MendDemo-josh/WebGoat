name: "Mend SAST with SARIF upload"

on:
  push:
      branches:
          - v*
          - main

jobs:
  mend-sast:
    runs-on: ubuntu-latest
    permissions:
      security-events: write
      actions: read
      contents: read

env:
  MEND_EMAIL: josh.newton@mend.io
  MEND_USER_KEY: 455f0d561fea42589a00bfeb246fb175c349c047a831484b97dc429949098d1c
  MEND_URL: https://saas.mend.io
  
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5

      # TODO: Install and authenticate Mend CLI
      # Add the appropriate steps to install the Mend CLI and authenticate
      # before running the scan (for example, via `mend auth login`).
      - name: Download Mend CLI
        run: |
         echo Downloading Mend CLI
                curl -LJO https://downloads.mend.io/production/unified/latest/linux_amd64/mend && chmod +x mend

      - name: Run Mend SAST and generate SARIF
        run: |
          # Generate a SARIF report named results.sarif in the repo root
          mend code --non-interactive --report --formats sarif --filename results || true

      - name: Upload SARIF to GitHub
        uses: github/codeql-action/upload-sarif@v4
        with:
          sarif_file: results.sarif
          category: mend-sast
